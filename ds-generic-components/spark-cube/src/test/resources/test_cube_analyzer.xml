<?xml version="1.0" encoding="UTF-8"?>
<cubes>
	<cube>
		<name>insights_dw_client_waf_1</name>
		
		<dimensions>
			<dimension mandatory="true">clnt_obj_id</dimension>
			<hierarchy>
				<dimension>yr_cd</dimension>
				<dimension>qtr_cd</dimension>
				<dimension>mnth_cd</dimension>
			</hierarchy>
			<hierarchy>
				<dimension>dummy_level1</dimension>
				<dimension>dummy_level2</dimension>
				<dimension>dummy_level3</dimension>
				<dimension>dummy_level4</dimension>
				<dimension>dummy_level5</dimension>
				<dimension>dummy_level6</dimension>
				<dimension>dummy_level7</dimension>
				<dimension>dummy_level8</dimension>
				<dimension>dummy_level9</dimension>
				<dimension>dummy_level10</dimension>
			</hierarchy>
			<dimension>d_full_tm_part_tm_cd</dimension>
			<dimension>d_pay_rt_type_cd</dimension>
			<dimension>d_job_cd</dimension>
			<!--  <dimension>d_work_loc_cd</dimension>
			<dimension>d_cmpny_cd</dimension>
			<dimension>d_hr_orgn_id</dimension>
			<dimension>d_eeo_ethncty_clsfn_dsc</dimension>
			<dimension>d_reg_temp_dsc</dimension>
			<dimension>d_flsa_stus_dsc</dimension>
			<dimension>d_work_state_cd</dimension>
			<dimension>d_gndr_cd</dimension>  -->
		</dimensions>
		
		<addons>
			<supportcolumns>
				<column>f_work_asgnmt_stus_cd</column>
			</supportcolumns>
		</addons>

		<facts>

			<fact>
				<name>num_person_days</name>
				<column>eff_person_days</column>
				<when>f_work_asgnmt_stus_cd in ('P','A','L','S')</when>
				<aggregation>
					<type>SUM</type>
				</aggregation>
			</fact>

			<fact>
				<name>num_voluntary_terminations</name>
				<column>vlntry_trmnt_ind</column>
				<aggregation>
					<type>SUM</type>
				</aggregation>
			</fact>

			<fact>
				<name>num_terminations</name>
				<column>trmnt_ind</column>
				<aggregation>
					<type>SUM</type>
				</aggregation>
			</fact>

			<fact>
				<name>num_promotions</name>
				<column>promo_ind</column>
				<aggregation>
					<type>SUM</type>
				</aggregation>
			</fact>

			<fact>
				<name>num_demotions</name>
				<column>dem_ind</column>
				<aggregation>
					<type>SUM</type>
				</aggregation>
			</fact>

			<fact>
				<name>num_hires</name>
				<column>hir_ind</column>
				<aggregation>
					<type>SUM</type>
				</aggregation>
			</fact>

			<fact>
				<name>num_rehires</name>
				<column>reh_ind</column>
				<aggregation>
					<type>SUM</type>
				</aggregation>
			</fact>

			<fact>
				<name>num_transfers</name>
				<column>xfr_ind</column>
				<aggregation>
					<type>SUM</type>
				</aggregation>
			</fact>

			<fact>
				<name>num_employees</name>
				<column>pers_obj_id</column>
				<aggregation>
					<type>APPROX_COUNT_DISTINCT</type>
					<arguments>
						<argument>clnt_obj_id</argument>
					</arguments>
				</aggregation>
			</fact>

			<fact>
				<name>female_percentage</name>
				<column>d_gndr_cd</column>
				<matches>F</matches>
				<aggregation>
					<type>PERCENT</type>
				</aggregation>
			</fact>

			<fact>
				<name>inactive_headcount</name> <!-- not very useful because of variable underlying period -->
				<column>pers_obj_id</column>
				<when>f_work_asgnmt_stus_cd in ('P','L','S')</when>
				<aggregation>
					<type>APPROX_COUNT_DISTINCT</type>
					<arguments>
						<argument>clnt_obj_id</argument>
					</arguments>
				</aggregation>
			</fact>

		</facts>

		<postprocess>
			<!-- Composite Facts -->
			<column>
				<name>annualized_turnover_rt</name>
				<expr>num_terminations / (num_person_days / sys_calendar_days)</expr>
			</column>
			<column>
				<name>annualized_voln_turnover_rt</name>
				<expr>num_voluntary_terminations / (num_person_days / sys_calendar_days)</expr>
			</column>
			<column>
				<name>internal_mobility_rate</name>
				<expr>(num_demotions + num_promotions + num_transfers)/(num_hires + num_terminations + num_rehires + num_demotions + num_promotions + num_transfers)</expr>
			</column>

			<!-- Optional filters to cut down size of the cube -->
			<filters>
				<filter>yr_cd is not null</filter>
			</filters>
		</postprocess>

	</cube>

</cubes> 
